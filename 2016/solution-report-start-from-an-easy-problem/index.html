
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>解题报告 —— 从水题开一个头 | Jayce&#39;s Tech Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="昨天碰到有人跟我讨论一道水题，勾起了解题的念头。题目固然不难，但也有值得讨论之处。姑且以它的解题报告，开个写解题报告的头。">
<meta property="og:type" content="article">
<meta property="og:title" content="解题报告 —— 从水题开一个头">
<meta property="og:url" content="http://jaycechant.info/2016/solution-report-start-from-an-easy-problem/index.html">
<meta property="og:site_name" content="Jayce's Tech Blog">
<meta property="og:description" content="昨天碰到有人跟我讨论一道水题，勾起了解题的念头。题目固然不难，但也有值得讨论之处。姑且以它的解题报告，开个写解题报告的头。">
<meta property="og:image" content="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png">
<meta property="og:updated_time" content="2016-12-08T02:53:19.125Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="解题报告 —— 从水题开一个头">
<meta name="twitter:description" content="昨天碰到有人跟我讨论一道水题，勾起了解题的念头。题目固然不难，但也有值得讨论之处。姑且以它的解题报告，开个写解题报告的头。">
<meta name="twitter:image" content="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png">
  
    <link rel="alternative" href="/atom.xml" title="Jayce&#39;s Tech Blog" type="application/atom+xml">
  
  
  <link rel="stylesheet" href="/css/style.css">
  <!--[if lt IE 9]><script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7/html5shiv.min.js"></script><![endif]-->
  
</head>
<body>
<div id="container">
  <div id="wrap">
    <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Jayce&#39;s Tech Blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">一个软件开发新丁的折腾笔记</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="https://github.com/JayceChant">Github</a>
        
          <a class="main-nav-link" href="/about">About</a>
        
          <a class="main-nav-link" href="/sitemap.xml">Sitemap</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="http://www.baidu.com/baidu" method="get" accept-charset="utf-8" class="search-form">
          <input type="search" name="word" maxlength="20" class="search-form-input" placeholder="Search">
          <input type="submit" value="" class="search-form-submit">
          <input name=tn type=hidden value="bds">
          <input name=cl type=hidden value="3">
          <input name=ct type=hidden value="2097152">
          <input type="hidden" name="si" value="jaycechant.info">
        </form>
      </div>
    </div>
  </div>
</header>
    <div class="outer">
      <section id="main"><article id="post-solution-report-start-from-an-easy-problem" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/solution-report-start-from-an-easy-problem/" class="article-date">
  <time datetime="2016-11-08T09:40:20.000Z" itemprop="datePublished">2016-11-08</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      解题报告 —— 从水题开一个头
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>昨天碰到有人跟我讨论一道水题，勾起了解题的念头。题目固然不难，但也有值得讨论之处。姑且以它的解题报告，开个写解题报告的头。</p>
<a id="more"></a>
<h1 id="源起"><a href="#源起" class="headerlink" title="源起"></a>源起</h1><p>在前公司工作四年，有两年半担任兼职讲师。一开始给非软件专业（一般是通信专业）的同事介绍Java，后来变成了主要讲解算法和数据结构题，以应对本社的软件能力等级考试。我和其他几个被选拔出来的讲师，工作时间里有一部分变成了光明正大地刷算法题。考试不过的同事把做题视作洪水猛兽，我们却AC之后继续研究优化，相当享受。当然还得做课件和上课又是一回事。</p>
<p>因为安保，所有资料都在公司内网。现在离开老东家，想把无关保密部分整理出来作为自己的积累，突然发现凭回忆非常零碎。老实说，多数题在ACM玩家来看，就算不是水题，也就中等难度；但钻研其中，算法的取舍，各种因素的权衡，也是一种修炼。自己资质一般，如果不这些所得用文字留下来，一不小心就会原地踏步。水题也好，重新开个头吧。</p>
<h1 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h1><p>题目来自口头转述，只有大意和约束：</p>
<ul>
<li><p>有一个 N * N 的矩阵图，上面有 M 个顺序编号的点（1 ~ M）和 一些无法通过的区域（9），余下区域为0。</p>
</li>
<li><p>求从 1 到 M 顺序经过全部点的 <strong>最短路径有多少条</strong> 。</p>
</li>
<li><p>从描述的例子看，还没轮到的点允许通过，只是后面轮到时还是得走一次。  </p>
<p>譬如说从 1 走到 5，先走 1 -&gt; 2 这段，到达 2 之前， 3、4、5 都相当于普通的点，也就是0，可以经过。而就算你经过了这三个点，譬如说 4 在 1-&gt; 2 的最短路径上，走到 3 时还是得往 4 走。</p>
</li>
<li><p>因为是水题，数据量极小， 3 ≤ N ≤ 7，3 ≤ M ≤ 5。也就是穷举型的思路都可以做。如果进一步想验证效率，可以人为调大数据量看看。（我以前跟毅跞经常这么干）</p>
</li>
</ul>
<h3 id="输入输出示例"><a href="#输入输出示例" class="headerlink" title="输入输出示例"></a>输入输出示例</h3><ul>
<li>输入</li>
</ul>
<pre><code>5 4
1 0 0 0 0
0 0 0 0 0
0 2 0 4 0
0 0 0 9 0
0 0 0 3 0
</code></pre><ul>
<li>输出</li>
</ul>
<pre><code>18
</code></pre><h1 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h1><h2 id="数学推导"><a href="#数学推导" class="headerlink" title="数学推导"></a>数学推导</h2><p>有些问题经数学推导之后，是可以有直接的公式解，而不需要一步步模拟的（典型的如 <strong>约瑟夫环</strong>）。退一步，如果问题本身无法直接推导，但是某种简化情况可以推导，也能为找思路提供方向。</p>
<h3 id="乘法原理"><a href="#乘法原理" class="headerlink" title="乘法原理"></a>乘法原理</h3><p>首先，题目里的点必须按顺序通过，那么根据 <strong>乘法原理</strong> ，最终答案等于 次序上相邻的点的最短路径数的乘积。假定 \( C_{a, b} \) 是 a 点 到 b 点之间的最短路径数，那么写成数学式就是：</p>
<p>$$ \prod <em>{i=1} ^{M - 1} {C </em>{i, i + 1}} $$</p>
<p>这就把问题简化成了两点之间的最短路径数了。不过似乎原题为了减低难度，在题目里就有提醒这点。</p>
<h3 id="排列组合"><a href="#排列组合" class="headerlink" title="排列组合"></a>排列组合</h3><p>假定我们不考虑禁行区（9）的存在，那么两点之间的最短路径，距离显然为他们之间的 <strong>曼哈顿距离</strong> 。</p>
<p>假设 <strong>横向的步数为W，纵向的步数为H</strong> ，同时横向移动一步标记为0，纵向标记为1，那么长度为 曼哈顿距离 的路径数，就相当于W个0和H个1的全排列：\( A(W+H) = (W+H)! \) 。但因为0 和 1都有大量重复，这并不是一个真正的全排列，所以还要把 0 和 1内部的组合数排除掉，最终得到： \( \frac{(W+H)!}{W! H!} \) 。</p>
<p>在 W+H不是特别大（换言之 (W+H)! 没有超出表示范围，以这题为例，W+H不超过7，那么最大的数不过5040）的情况下，这样就可以提前缓存好 N!，那么在W 和 H 确定之后只要做两次除法就得到答案了。</p>
<p>当然，这只是顺便延伸一下，实际上这道题因为 9 的存在，不能这么算。</p>
<h1 id="代码参考"><a href="#代码参考" class="headerlink" title="代码参考"></a>代码参考</h1><h2 id="Brute-force-dfs"><a href="#Brute-force-dfs" class="headerlink" title="Brute-force (dfs)"></a>Brute-force (dfs)</h2><blockquote>
<p>注1：这里开始会贴代码。一般我用 C/C++ 完成算法题，可以比较好地选择底层的数据结构实现。不过这里为了节省空间，用了Python来展示代码，而且只贴关键函数，输入输出部分就略过了。Python的代码非常接近 伪代码，相信没有写过Python的朋友也能很好理解。</p>
<p>注2：为了简便，这里的队列我直接用了list。但实际上list 的 pop(0) 会修改后面全部元素的位置，复杂度是O(n)。Python里更好的选择是deque，C/C++可以使用STL或者自己实现一个循环队列。</p>
</blockquote>
<p>如果没能直接找到数学关系直接计算，也没能一眼看出合适的算法，那么暴力不失为一个好的开始。具体到这里，暴力的做法一般就是用DFS穷举所有可能的路径，找出中间最短那几条。</p>
<p>当然，直接暴力，内存和时间复杂度都会很夸张（这里如果不限制长度，先穷举所有路径，再计算其中最短的数量，操作是很庞大的），所以哪怕是第一份代码，我也加入了一些直接能想到的剪枝：一旦发现了dis大小的路径，那么所有大于dis的路径都不必再尝试了。</p>
<p>示例代码一：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">dfs</span><span class="params">(sp, ep, dis)</span>:</span></div><div class="line">    <span class="keyword">global</span> MinDis, CntWay, Vis</div><div class="line">    dis += <span class="number">1</span></div><div class="line">    <span class="keyword">if</span> dis &gt; MinDis:</div><div class="line">        <span class="comment"># prunning</span></div><div class="line">        <span class="keyword">return</span></div><div class="line"></div><div class="line">    <span class="keyword">if</span> sp[<span class="number">0</span>] == ep[<span class="number">0</span>] <span class="keyword">and</span> sp[<span class="number">1</span>] == ep[<span class="number">1</span>]:</div><div class="line">        <span class="keyword">if</span> dis == MinDis:</div><div class="line">            CntWay += <span class="number">1</span></div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            <span class="comment"># dis &lt; MinDis</span></div><div class="line">            MinDis = dis</div><div class="line">            CntWay = <span class="number">1</span></div><div class="line">        </div><div class="line">        <span class="keyword">return</span></div><div class="line">        </div><div class="line">    <span class="comment"># up</span></div><div class="line">    row, col = sp</div><div class="line">    row -= <span class="number">1</span></div><div class="line">    <span class="keyword">if</span> row &gt;= <span class="number">0</span> <span class="keyword">and</span> <span class="keyword">not</span> Vis[row][col] <span class="keyword">and</span> Map[row][col] != <span class="number">9</span>:</div><div class="line">        Vis[row][col] = <span class="keyword">True</span></div><div class="line">        dfs((row, col), ep, dis)</div><div class="line">        Vis[row][col] = <span class="keyword">False</span></div><div class="line">        </div><div class="line">    <span class="comment"># down</span></div><div class="line">    row += <span class="number">2</span></div><div class="line">    <span class="keyword">if</span> row &lt; N <span class="keyword">and</span> <span class="keyword">not</span> Vis[row][col] <span class="keyword">and</span> Map[row][col] != <span class="number">9</span>:</div><div class="line">        Vis[row][col] = <span class="keyword">True</span></div><div class="line">        dfs((row, col), ep, dis)</div><div class="line">        Vis[row][col] = <span class="keyword">False</span></div><div class="line">        </div><div class="line">    <span class="comment"># left</span></div><div class="line">    row -= <span class="number">1</span></div><div class="line">    col -= <span class="number">1</span></div><div class="line">    <span class="keyword">if</span> col &gt;= <span class="number">0</span> <span class="keyword">and</span> <span class="keyword">not</span> Vis[row][col] <span class="keyword">and</span> Map[row][col] != <span class="number">9</span>:</div><div class="line">        Vis[row][col] = <span class="keyword">True</span></div><div class="line">        dfs((row, col), ep, dis)</div><div class="line">        Vis[row][col] = <span class="keyword">False</span></div><div class="line">        </div><div class="line">    <span class="comment"># right</span></div><div class="line">    col += <span class="number">2</span></div><div class="line">    <span class="keyword">if</span> col &lt; N <span class="keyword">and</span> <span class="keyword">not</span> Vis[row][col] <span class="keyword">and</span> Map[row][col] != <span class="number">9</span>:</div><div class="line">        Vis[row][col] = <span class="keyword">True</span></div><div class="line">        dfs((row, col), ep, dis)</div><div class="line">        Vis[row][col] = <span class="keyword">False</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">findWay</span><span class="params">(sp, ep)</span>:</span></div><div class="line">    <span class="keyword">global</span> MinDis, Vis</div><div class="line">    MinDis = MAX</div><div class="line">    Vis[sp[<span class="number">0</span>]][sp[<span class="number">1</span>]] = <span class="keyword">True</span></div><div class="line">    dfs(sp, ep, <span class="number">0</span>)</div><div class="line">    Vis[sp[<span class="number">0</span>]][sp[<span class="number">1</span>]] = <span class="keyword">False</span></div><div class="line">    <span class="keyword">return</span> CntWay</div></pre></td></tr></table></figure>
<p>以上的代码是基于来问我的人的代码，把里面的错误改掉之后得到的。主函数调用findWay() 即可。关键部分在于到达目标时的判断：如果当前这条路的距离跟最短距离相等，那么计数器加一；否则就是发现了更短的路（不存在更长的情况，因为剪枝处理掉了），更新最短距离，并把计数器置一（注意不是置零）。</p>
<p>如果调整一下代码，还能把公共部分的检查提取出来。示例代码二：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">dfs</span><span class="params">(sp, ep, dis)</span>:</span></div><div class="line">    <span class="keyword">global</span> MinDis, CntWay, Vis</div><div class="line">    row, col = sp</div><div class="line">    <span class="comment"># log(sp, dis, MinDis, Vis[row][col])</span></div><div class="line">    dis += <span class="number">1</span></div><div class="line">    <span class="comment"># legal check and prunning</span></div><div class="line">    <span class="keyword">if</span> dis &gt; MinDis <span class="keyword">or</span> Vis[row][col] <span class="keyword">or</span> Map[row][col] == <span class="number">9</span>:</div><div class="line">        <span class="keyword">return</span></div><div class="line"></div><div class="line">    <span class="keyword">if</span> row == ep[<span class="number">0</span>] <span class="keyword">and</span> col == ep[<span class="number">1</span>]:</div><div class="line">        <span class="keyword">if</span> dis == MinDis:</div><div class="line">            CntWay += <span class="number">1</span></div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            <span class="comment"># dis &lt; MinDis</span></div><div class="line">            MinDis = dis</div><div class="line">            CntWay = <span class="number">1</span></div><div class="line">        </div><div class="line">        <span class="keyword">return</span></div><div class="line">        </div><div class="line">    Vis[row][col] = <span class="keyword">True</span></div><div class="line">    <span class="comment"># up</span></div><div class="line">    row -= <span class="number">1</span></div><div class="line">    <span class="keyword">if</span> row &gt;= <span class="number">0</span>:</div><div class="line">        dfs((row, col), ep, dis)</div><div class="line">        </div><div class="line">    <span class="comment"># down</span></div><div class="line">    row += <span class="number">2</span></div><div class="line">    <span class="keyword">if</span> row &lt; N:</div><div class="line">        dfs((row, col), ep, dis)</div><div class="line">        </div><div class="line">    <span class="comment"># left</span></div><div class="line">    row -= <span class="number">1</span></div><div class="line">    col -= <span class="number">1</span></div><div class="line">    <span class="keyword">if</span> col &gt;= <span class="number">0</span>:</div><div class="line">        dfs((row, col), ep, dis)</div><div class="line">        </div><div class="line">    <span class="comment"># right</span></div><div class="line">    col += <span class="number">2</span></div><div class="line">    <span class="keyword">if</span> col &lt; N:</div><div class="line">        dfs((row, col), ep, dis)</div><div class="line">        </div><div class="line">    Vis[sp[<span class="number">0</span>]][sp[<span class="number">1</span>]] = <span class="keyword">False</span></div></pre></td></tr></table></figure>
<h2 id="BFS"><a href="#BFS" class="headerlink" title="BFS"></a>BFS</h2><p>DFS冗余运算比较多，就会很自然地想，BFS能不能有所改善呢？</p>
<p>能不能改善先不管，我们先用BFS做出来。示例代码三：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">bfs</span><span class="params">(sp, ep)</span>:</span></div><div class="line">    cnt_way = <span class="number">0</span></div><div class="line">    <span class="comment"># None as step flag</span></div><div class="line">    queue = [sp, <span class="keyword">None</span>]</div><div class="line">    arrive = <span class="keyword">False</span></div><div class="line"></div><div class="line">    <span class="keyword">while</span> len(queue) &gt; <span class="number">1</span>:</div><div class="line">        point = queue.pop(<span class="number">0</span>)</div><div class="line">        <span class="keyword">if</span> <span class="keyword">not</span> point:</div><div class="line">            <span class="keyword">if</span> arrive:</div><div class="line">                <span class="keyword">return</span> cnt_way</div><div class="line">            queue.append(<span class="keyword">None</span>)</div><div class="line">            <span class="keyword">continue</span></div><div class="line"></div><div class="line">        row, col = point</div><div class="line">        <span class="comment"># legal check</span></div><div class="line">        <span class="keyword">if</span> Map[row][col] == <span class="number">9</span>:</div><div class="line">            <span class="keyword">continue</span></div><div class="line"></div><div class="line">        <span class="keyword">if</span> row == ep[<span class="number">0</span>] <span class="keyword">and</span> col == ep[<span class="number">1</span>]:</div><div class="line">            cnt_way += <span class="number">1</span></div><div class="line">            arrive = <span class="keyword">True</span></div><div class="line">            <span class="keyword">continue</span></div><div class="line"></div><div class="line">        <span class="comment"># up</span></div><div class="line">        row -= <span class="number">1</span></div><div class="line">        <span class="keyword">if</span> row &gt;= <span class="number">0</span>:</div><div class="line">            queue.append((row, col))</div><div class="line"></div><div class="line">        <span class="comment"># down</span></div><div class="line">        row += <span class="number">2</span></div><div class="line">        <span class="keyword">if</span> row &lt; N:</div><div class="line">            queue.append((row, col))</div><div class="line"></div><div class="line">        <span class="comment"># left</span></div><div class="line">        row -= <span class="number">1</span></div><div class="line">        col -= <span class="number">1</span></div><div class="line">        <span class="keyword">if</span> col &gt;= <span class="number">0</span>:</div><div class="line">            queue.append((row, col))</div><div class="line"></div><div class="line">        <span class="comment"># right</span></div><div class="line">        col += <span class="number">2</span></div><div class="line">        <span class="keyword">if</span> col &lt; N:</div><div class="line">            queue.append((row, col))</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="number">0</span></div></pre></td></tr></table></figure>
<p>基本原理跟之前的暴力法差不多，都是穷举所有可能的路径并且计数。</p>
<p>改善的地方在于，DFS是一条路走到底再去试别的路，你没办法预知先试的路是长还是短；<strong>BFS可以看作多条路同时往外挪步，后面的路肯定是比当前路要长（或者相当，起码不可能更短）</strong> ，一旦到达目标，后面更长的路可以不用直接尝试了。这里我用了一个None作为层次标记，一旦到达，只把同距离的计数完就退出。</p>
<p>但这也有代价：因为同时挪步，为了不互相影响，BFS不能像DFS标记走过的点，所以队列里其实有大量 <strong>来回步</strong> ！如果地图比较大（这样DFS有些路就要走很远才到头），而实际点与点之间比较近（BFS很快就能结束），那么这份代码是比DFS效率高一些的； 但如果反过来（譬如有些相邻点分布在对角线上两头），大量来回步造成的浪费更多，那么这种做法实际得不偿失。</p>
<h3 id="BFS-DP"><a href="#BFS-DP" class="headerlink" title="BFS + DP"></a>BFS + DP</h3><p>能不能像DFS那样也记录已走过的点，然后不重复走？</p>
<p><strong><em>TODO: 此处最好有图，mark一个，有空补</em></strong></p>
<p>不行。因为可能有多条最短路径会通过同一个点，如果一个点只能走一次，会漏算大量的路径。DFS之所以可以这么做，是因为回溯时会恢复状态，记录只是为了不走回头路，别的路径还是能通过这个点。</p>
<p>那如果我们做更详细的标记呢？譬如引入：OPEN（没走过），CLOSE（已离开） 以及 ONGOING（进行中） 三个状态。对应队列的状态，分别就是 <strong>从未进队</strong> ， <strong>已入队并出队</strong> 和 <strong>正在队列中</strong> 三种状态。</p>
<p>我们知道，BFS的特性会让 <strong>从起点起同样距离的点</strong> 一起访问完，然后才会继续尝试 + 1 距离的点，一层层往外走。那么假定从X点往外一步访问到一个Y点，并且Y的状态为：（下面的dis(X)指起点到X点的最短距离）</p>
<ol>
<li>OPEN，Y点从未被访问，直接进队并且改为ONGOING</li>
<li>CLOSE，Y点被其它点访问过，并且 <strong>Y已经在X之前</strong> 出队了，dis(Y) ≤ dis(X)， 经X再到Y这种走法，至少比之前到Y的走法要额外多一步（假定dis(Y) = dis(X)的话，至少还要加上一步；如果是 &lt; ，那就不止了），<strong>这种走法无论如何不能再产生最短路径了</strong> （划重点，请仔细体会这句话），所以Y不用再进队了</li>
<li>ONGOING，Y点被其它点访问过，并且还没出队，而X现在作为起点，说明刚刚出队，dis(Y) ≥ dis(X)，那么经X到Y这种走法，起码还是有可能存在一条最短路径的，Y点再次入队</li>
</ol>
<p>这种做法把CLOSE状态下的冗余给去掉了。因为一个点的前置节点一个是已经CLOSE掉的，所以回头路也不会存在了。</p>
<p>不过这种改进仍然是有限的，从目前的推导看，ONGOING里还是可能存在 dis(Y) = dis(X) 的情况的浪费，而且其实同一个点多次进队也是没有必要的。这种改进改动的代码不多，我就不再贴示例了。</p>
<h4 id="DP"><a href="#DP" class="headerlink" title="DP"></a>DP</h4><p><strong><em>如果不是为了引导问我的人一步一步考虑到这里，这种水题真想一开始直接写DP</em></strong></p>
<p>讨论DP之前，还要引入这道题具有的一个性质：以任意点为起点，相邻的点的dis值都不会相等。</p>
<p>首先我们来看一下没有障碍物的情况，下图以0处为起点，标出起点到各点的最短距离：</p>
<pre><code>3 2 1 2 3
2 1 0 1 2
3 2 1 2 3
4 3 2 3 4
5 4 3 4 5
</code></pre><p>很容易得出，无论以哪里为起点，相邻的点的dis值一定是相差1。</p>
<p>而如果我们往上放一个障碍物呢，这时 障碍物在不在从起点到终点 <strong>唯一的最短路径上</strong> 有两种情况（注意，是唯一）：</p>
<ul>
<li>不在（可能根本不在任何一条最短路径上毫无影响，也可能影响其中一条，剩下的还能走），那么依然存在这个dis值的最短路径，不改变该终点的dis值。</li>
<li>在，那么又有两种情况：<ul>
<li>绕路：由于绕路而造成的dis值增大，必然是偶数的。由于只能上下左右移动，不能对角移动，绕路产生的额外移动，都是关于障碍物对称的。</li>
<li>从旁边没有被障碍物影响的点走一步过来。由于唯一的最短路径已经被障碍物影响，剩下没被影响的点，都是dis+1，再往回走一步，就变成了dis+2。</li>
</ul>
</li>
</ul>
<p>无论是哪种情况，变动的值都是偶数。而且这个性质在连续增加障碍物的过程中依然有效。所以相邻的点dis值不可能相等，依然保持相差1。（只是说变动都是偶数而已，相差不应该是2k+1吗，为什么一定是1？这里可以思考一下why）</p>
<p>接下来说DP：</p>
<p>动态规划的做法是，定义子问题，并且找到子问题之间的状态转移方程。如果中间有子问题的解是能被多次引用，那么对子问题解的缓存就能改善运算效率。这里不打算详细说DP，直接给转移方程：（提醒一下，题目是要求最短路径的数量）</p>
<p>假设 cw(x, y) （Count Way 缩写）是 起点 到 (x, y) 这个点的最短路径的数量，那么</p>
<p>$$ cw(x, y) = \sum{ cw(x-1, y), cw(x+1, y), cw(x, y-1), cw(x, y+1)} $$</p>
<p>计算过程中，我们需要一个表，用来记录cw值（dis值由BFS特性保证）。需要额外开辟一个表吗？其实不需要，我们把上面的状态再扩展一下，变成cw值就好：cw &gt; 0 时，对应ONGOING；那么为了避免冲突，我把OPEN定义为0，CLOSE定义为-1。</p>
<p>OPEN 和 CLOSE 状态的处理都不用变，而ONGOING的处理变成对cw值大小的判断：</p>
<!-- TODO: 是否可以处理dis相等的点相邻的情况 ！？-->
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">bfs</span><span class="params">(sp, ep)</span>:</span></div><div class="line">    cnt_way = [([OPEN] * N) <span class="keyword">for</span> i <span class="keyword">in</span> range(N)]</div><div class="line">    cnt_way[sp[<span class="number">0</span>]][sp[<span class="number">1</span>]] = <span class="number">1</span></div><div class="line">    queue = [sp]</div><div class="line"></div><div class="line">    <span class="keyword">while</span> len(queue) &gt; <span class="number">0</span>:</div><div class="line">        row, col = queue.pop(<span class="number">0</span>)</div><div class="line"></div><div class="line">        <span class="comment"># legal check</span></div><div class="line">        <span class="keyword">if</span> Map[row][col] == <span class="number">9</span>:</div><div class="line">            <span class="keyword">continue</span></div><div class="line"></div><div class="line">        <span class="keyword">if</span> row == ep[<span class="number">0</span>] <span class="keyword">and</span> col == ep[<span class="number">1</span>]:</div><div class="line">            <span class="keyword">return</span> cnt_way[ep[<span class="number">0</span>]][ep[<span class="number">1</span>]]</div><div class="line"></div><div class="line">        <span class="comment"># up</span></div><div class="line">        r = row - <span class="number">1</span></div><div class="line">        <span class="keyword">if</span> r &gt;= <span class="number">0</span> <span class="keyword">and</span> cnt_way[r][col] != CLOSED:</div><div class="line">            <span class="keyword">if</span> cnt_way[r][col] == OPEN:</div><div class="line">                queue.append((r, col))</div><div class="line">            cnt_way[r][col] += cnt_way[row][col]</div><div class="line"></div><div class="line">        <span class="comment"># down</span></div><div class="line">        r = row + <span class="number">1</span></div><div class="line">        <span class="keyword">if</span> r &lt; N <span class="keyword">and</span> cnt_way[r][col] != CLOSED:</div><div class="line">            <span class="keyword">if</span> cnt_way[r][col] == OPEN:</div><div class="line">                queue.append((r, col))</div><div class="line">            cnt_way[r][col] += cnt_way[row][col]</div><div class="line"></div><div class="line">        <span class="comment"># left</span></div><div class="line">        c = col - <span class="number">1</span></div><div class="line">        <span class="keyword">if</span> c &gt;= <span class="number">0</span> <span class="keyword">and</span> cnt_way[row][c] != CLOSED:</div><div class="line">            <span class="keyword">if</span> cnt_way[row][c] == OPEN:</div><div class="line">                queue.append((row, c))</div><div class="line">            cnt_way[row][c] += cnt_way[row][col]</div><div class="line"></div><div class="line">        <span class="comment"># right</span></div><div class="line">        c = col + <span class="number">1</span></div><div class="line">        <span class="keyword">if</span> c &lt; N <span class="keyword">and</span> cnt_way[row][c] != CLOSED:</div><div class="line">            <span class="keyword">if</span> cnt_way[row][c] == OPEN:</div><div class="line">                queue.append((row, c))</div><div class="line">            cnt_way[row][c] += cnt_way[row][col]</div><div class="line"></div><div class="line">        cnt_way[row][col] = CLOSED</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="number">0</span></div></pre></td></tr></table></figure>
<hr>
<p><img src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" alt="知识共享 “署名-非商业性使用-相同方式共享” 4.0 (CC BY-NC-SA 4.0)”许可协议"><br>本文为本人原创，采用<a href="http://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="external">知识共享 “署名-非商业性使用-相同方式共享” 4.0 (CC BY-NC-SA 4.0)”许可协议</a>进行许可。<br>本作品可自由复制、传播及基于本作品进行演绎创作。如有以上需要，请留言告知，在文章开头明显位置加上署名（Jayce Chant）、原链接及许可协议信息，并明确指出修改（如有），不得用于商业用途。谢谢合作。<br>详情请点击查看<a href="http://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="external">协议</a>具体内容。</p>

      
    </div>
    <footer class="article-footer">
      
        <a data-url="http://jaycechant.info/2016/solution-report-start-from-an-easy-problem/" data-id="cix2mcvyl000v0wlnzsswveen" class="article-share-link" data-share="baidu">分享到</a>
      

      
        <a href="http://jaycechant.info/2016/solution-report-start-from-an-easy-problem/#disqus_thread" class="article-comment-link">评论</a>
      

      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/algorithm/">algorithm</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2016/skills-on-OJ/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">下一篇</strong>
      <div class="article-nav-title">
        
          刷OJ的技巧
        
      </div>
    </a>
  
  
    <a href="/2016/python-function-and-class-alias/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">上一篇</strong>
      <div class="article-nav-title">Python 函数和类的别名</div>
    </a>
  
</nav>

  
</article>


  <section id="comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>
  </section>
</section>
      
      <aside id="sidebar">
  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Markdown/">Markdown</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mathjax/">Mathjax</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OJ/">OJ</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Octopress/">Octopress</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/">Python</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Syncthing/">Syncthing</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/algorithm/">algorithm</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/blog/">blog</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/dropbox/">dropbox</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/">git</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/">hexo</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/how-to/">how-to</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/netdisk/">netdisk</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/node-js/">node.js</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nodePPT/">nodePPT</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pip/">pip</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/practice/">practice</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ruby/">ruby</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/skill/">skill</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tips/">tips</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/virtualenv/">virtualenv</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/Markdown/" style="font-size: 10px;">Markdown</a> <a href="/tags/Mathjax/" style="font-size: 10px;">Mathjax</a> <a href="/tags/OJ/" style="font-size: 10px;">OJ</a> <a href="/tags/Octopress/" style="font-size: 10px;">Octopress</a> <a href="/tags/Python/" style="font-size: 16.67px;">Python</a> <a href="/tags/Syncthing/" style="font-size: 10px;">Syncthing</a> <a href="/tags/algorithm/" style="font-size: 13.33px;">algorithm</a> <a href="/tags/blog/" style="font-size: 13.33px;">blog</a> <a href="/tags/dropbox/" style="font-size: 10px;">dropbox</a> <a href="/tags/git/" style="font-size: 10px;">git</a> <a href="/tags/hexo/" style="font-size: 10px;">hexo</a> <a href="/tags/how-to/" style="font-size: 20px;">how-to</a> <a href="/tags/netdisk/" style="font-size: 10px;">netdisk</a> <a href="/tags/node-js/" style="font-size: 13.33px;">node.js</a> <a href="/tags/nodePPT/" style="font-size: 13.33px;">nodePPT</a> <a href="/tags/pip/" style="font-size: 10px;">pip</a> <a href="/tags/practice/" style="font-size: 10px;">practice</a> <a href="/tags/ruby/" style="font-size: 10px;">ruby</a> <a href="/tags/skill/" style="font-size: 13.33px;">skill</a> <a href="/tags/tips/" style="font-size: 10px;">tips</a> <a href="/tags/virtualenv/" style="font-size: 10px;">virtualenv</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">十二月 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">十一月 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">十月 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">八月 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">七月 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">六月 2016</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/04/">四月 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/04/">四月 2012</a><span class="archive-list-count">5</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">近期文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2016/some-good-features-on-CentOS/">CentOS 一些好用的特性</a>
          </li>
        
          <li>
            <a href="/2016/skills-on-OJ/">刷OJ的技巧</a>
          </li>
        
          <li>
            <a href="/2016/solution-report-start-from-an-easy-problem/">解题报告 —— 从水题开一个头</a>
          </li>
        
          <li>
            <a href="/2016/python-function-and-class-alias/">Python 函数和类的别名</a>
          </li>
        
          <li>
            <a href="/2016/backup-tips-about-syncthing/">用Syncthing备份的一些技巧</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">友情链接</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="https://hexo.io/zh-cn/" target="_blank">Hexo主页</a>
          </li>
        
          <li>
            <a href="https://hexo.io/zh-cn/docs/" target="_blank">Hexo文档</a>
          </li>
        
          <li>
            <a href="https://github.com/xiangming/landscape-plus" target="_blank">landscape-plus项目主页</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
      
    </div>
    <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 Jayce S. Chant<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
      .
      Theme by <a href="https://github.com/xiangming/landscape-plus" target="_blank">Landscape-plus</a>
    </div>
  </div>
</footer>
  </div>
  <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="https://github.com/JayceChant" class="mobile-nav-link">Github</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
    <a href="/sitemap.xml" class="mobile-nav-link">Sitemap</a>
  
</nav>
  <!-- totop start -->
<div id="totop">
<a title="返回顶部"><img src="/img/scrollup.png"/></a>
</div>

<!-- totop end -->

<script>
  var disqus_shortname = 'jaycetb';
  
  var disqus_url = 'http://jaycechant.info/2016/solution-report-start-from-an-easy-problem/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<!-- 百度分享 start -->

<div id="article-share-box" class="article-share-box">
  <div id="bdshare" class="bdsharebuttonbox article-share-links">
    <a class="article-share-weibo" data-cmd="tsina" title="分享到新浪微博"></a>
    <a class="article-share-weixin" data-cmd="weixin" title="分享到微信"></a>
    <a class="article-share-qq" data-cmd="sqq" title="分享到QQ"></a>
    <a class="article-share-renren" data-cmd="renren" title="分享到人人网"></a>
    <a class="article-share-more" data-cmd="more" title="更多"></a>
  </div>
</div>
<script>window._bd_share_config={"common":{},"share":{"bdCustomStyle":"/css/bdshare.css"}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='//bdimg.share.baidu.com/static/api/js/share.js?cdnversion='+~(-new Date()/36e5)];</script>

<!-- 百度分享 end -->

<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>




<! -- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
                processEscapes: true
                    
}
  
        });
</script>

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
tex2jax: {
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
                  
}
    
        });
</script>

<script type="text/x-mathjax-config">
MathJax.Hub.Queue(function() {
            var all = MathJax.Hub.getAllJax(), i;
            for(i=0; i < all.length; i += 1) {
                            all[i].SourceElement().parentNode.className += ' has-jax';
                                    
            }
                
        });
</script>

<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


<script src="/js/script.js"></script>

</div>
</body>
</html>
