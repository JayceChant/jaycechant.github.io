
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Go 语言实战（3）： 类型 | 存档Save&amp;Load</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="这期讲 Go 的类型。
Go 的数据类型分为基本类型和派生类型。篇幅关系，这期主要讲 基本类型，派生类型简单带过。">
<meta property="og:type" content="article">
<meta property="og:title" content="Go 语言实战（3）： 类型">
<meta property="og:url" content="https://jaycechant.info/2020/golang-in-action-day-3/index.html">
<meta property="og:site_name" content="存档Save&Load">
<meta property="og:description" content="这期讲 Go 的类型。
Go 的数据类型分为基本类型和派生类型。篇幅关系，这期主要讲 基本类型，派生类型简单带过。">
<meta property="og:image" content="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png">
<meta property="og:updated_time" content="2020-09-24T18:44:56.149Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Go 语言实战（3）： 类型">
<meta name="twitter:description" content="这期讲 Go 的类型。
Go 的数据类型分为基本类型和派生类型。篇幅关系，这期主要讲 基本类型，派生类型简单带过。">
<meta name="twitter:image" content="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png">
  
    <link rel="alternative" href="/atom.xml" title="存档Save&amp;Load" type="application/atom+xml">
  
  
  <link rel="stylesheet" href="/css/style.css">
  <!--[if lt IE 9]><script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7/html5shiv.min.js"></script><![endif]-->
  
</head>
<body>
<div id="container">
  <div id="wrap">
    <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">存档Save&amp;Load</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">存档意味着放下包袱，搞砸了不过回来读档</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/list">List</a>
        
          <a class="main-nav-link" href="https://github.com/JayceChant">Github</a>
        
          <a class="main-nav-link" href="/about">About</a>
        
          <a class="main-nav-link" href="/sitemap.xml">Sitemap</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
        
      </nav>
      
      <div id="search-form-wrap">
        <form action="" accept-charset="utf-8" class="search-form">
          <input id="searchtext" type="search" name="q" maxlength="20" class="search-form-input" placeholder="Search" onkeypress="if(event.keyCode==13){document.getElementById('searchsub').click();return false;}">
          <input id="searchsub" type="submit" value="" class="search-form-submit" onclick="window.open('https://global.bing.com/search?&amp;q=site:jaycechant.info '+document.getElementById('searchtext').value, '_blank')">
        </form>
      </div>
      
    </div>
  </div>
</header>
    <div class="outer">
      <section id="main"><article id="post-golang-in-action-day-3" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/golang-in-action-day-3/" class="article-date">
  <time datetime="2020-09-10T09:14:28.000Z" itemprop="datePublished">2020-09-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Go-语言实战/">Go 语言实战</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Go 语言实战（3）： 类型
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>这期讲 Go 的类型。</p>
<p>Go 的数据类型分为基本类型和派生类型。篇幅关系，这期主要讲 基本类型，派生类型简单带过。</p>
<a id="more"></a>
<p>往期内容：</p>
<ul>
<li><a href="../../categories/Go-语言实战/">Go 语言实战</a></li>
</ul>
<h2 id="类型"><a href="#类型" class="headerlink" title="类型"></a>类型</h2><p>下面的内容，会反复提到一个词：零值。如果声明一个变量，却不指定它的值，又或者直接 <code>new(T)</code> （T 是某个类型）申请一块内存，Go 会把这块内存置零。但同样是 0，在不同的类型下，会有不同的语义。了解零值，就是要知道不同类型的默认值的含义和行为。</p>
<h3 id="1-基本类型"><a href="#1-基本类型" class="headerlink" title="1. 基本类型"></a>1. 基本类型</h3><p>基本类型又分为 布尔类型、数字类型 和 字符串类型。</p>
<h4 id="1-1-布尔类型"><a href="#1-1-布尔类型" class="headerlink" title="1.1 布尔类型"></a>1.1 布尔类型</h4><p>类型标识符 <code>bool</code>，零值为 false。bool 没有直接的字面量，<code>true</code> 和 <code>false</code> 在 Go 是预定义的 bool 常量，不过使用上跟字面量没有太大区别。而很多时候，用到的不是这两个常量，而是 关系运算的结果 （关系运算符 <code>==</code> ， <code>!=</code> ，<code>&gt;</code> ， <code>&gt;=</code> ， <code>&lt;</code> ， <code>&lt;=</code>）和 函数返回值。</p>
<p>要注意的是，不像有些语言 bool 其实是数值类型的一种特例，可以或显式或隐式转换成数值。<strong>Go 的 bool 不是数值，也无法转换为数值，无法参与任何 数值运算（加减乘除） 和 位运算（按位与、或、取反等）；反之，数值也不能转换为 bool</strong>。</p>
<p>假设现在有 int 数组 <code>nums</code> ，要统计其中大于 0 的数的个数：</p>
<p>C 里面可以这样</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> size = <span class="keyword">sizeof</span>(nums) / <span class="keyword">sizeof</span>(<span class="keyword">int</span>);</div><div class="line"><span class="keyword">int</span> count = <span class="number">0</span>;</div><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; i++) &#123;</div><div class="line">    <span class="comment">// C 里面没有专门的布尔值，所以 true 本来就以整型数 1 代表</span></div><div class="line">    <span class="comment">// 反过来，所有非零值都会被看作 true</span></div><div class="line">    <span class="comment">// 括号非必要，只是为了看起来清晰</span></div><div class="line">    count += (nums[i] &gt; <span class="number">0</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>但在 Go 里会报错</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> count <span class="keyword">int</span> = <span class="number">0</span></div><div class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(nums); i++ &#123;</div><div class="line">    <span class="comment">// 编译器报错 cannot convert nums[i] &gt; 0 (untyped bool value) to int</span></div><div class="line">    <span class="comment">// 即使加上显式转换 int(nums[i] &gt; 0) 也不行</span></div><div class="line">    count += (nums[i] &gt; <span class="number">0</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>只能老老实实用 <code>if</code></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> count <span class="keyword">int</span> = <span class="number">0</span></div><div class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(nums); i++ &#123;</div><div class="line">    <span class="keyword">if</span> nums[i] &gt; <span class="number">0</span> &#123;</div><div class="line">        count++</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="1-2-数字类型"><a href="#1-2-数字类型" class="headerlink" title="1.2 数字类型"></a>1.2 数字类型</h4><p>包括整型数、浮点数、复数等，区分有符号、无符号，还有不同字节长度选择（对应不同的内存占用和数值范围），有多种组合，具体看表格。</p>
<table>
<thead>
<tr>
<th></th>
<th>1 字节</th>
<th>2 字节</th>
<th>4 字节</th>
<th>8 字节</th>
<th>16字节</th>
<th>架构相关</th>
</tr>
</thead>
<tbody>
<tr>
<td>无符号整型</td>
<td>uint8</td>
<td>uint16</td>
<td>uint32</td>
<td>uint64</td>
<td></td>
<td>uint</td>
</tr>
<tr>
<td>有符号整型</td>
<td>int8</td>
<td>int16</td>
<td>int32</td>
<td>int64</td>
<td></td>
<td>int</td>
</tr>
<tr>
<td>浮点数</td>
<td></td>
<td></td>
<td>float32</td>
<td>float64</td>
<td></td>
<td></td>
</tr>
<tr>
<td>复数</td>
<td></td>
<td></td>
<td></td>
<td>complex64</td>
<td>complex128</td>
<td></td>
</tr>
<tr>
<td>特殊类型</td>
<td>byte</td>
<td></td>
<td>rune</td>
<td></td>
<td></td>
<td>uintptr</td>
</tr>
</tbody>
</table>
<ul>
<li>数字类型的零值均为 0，各种意义上的零（整数零 <code>0</code> ，浮点数零  <code>0.0</code> ， 复数零 <code>0+0i</code>）。</li>
<li>数字类型的字面量，涉及类型推断，参考上一期的字面量部分。</li>
<li><code>byte</code> 是 <code>uint8</code> 的别名，<code>rune</code> 是 <code>int32</code> 的别名。类型别名以后再详细展开，你只要知道它们是同一个类型就可以了。</li>
<li><strong>除了复数以外，所有数值类型的变量之间可以互相转换。</strong> 规则参考上期的类型转换部分。</li>
<li>复数需要经由内置函数提取 实部 和 虚部（都是浮点数），或者将两个浮点数组合成复数。如果不是科学计算，一般很少用到复数，可以留个印象，用到再查。</li>
</ul>
<h5 id="位宽、范围与精度"><a href="#位宽、范围与精度" class="headerlink" title="位宽、范围与精度"></a>位宽、范围与精度</h5><p>位宽是类型后面的数字，它表示该类型占用了多少个二进制位。因为计算机以 字节（byte，等于 8 bit）为组织单位，位宽总是 8 的 2 整数次方倍。</p>
<p><code>uint</code> 、<code>int</code> 和 <code>uintptr</code> 三个类型的位宽与系统架构相关。其中 <code>uint</code> 和 <code>int</code> 不小于 32 位，在 64 位系统则为 64 位；但需要注意它们是独立的类型，以 <code>int</code> 在 64 位系统为例，尽管范围完全一样，<code>int</code> 变量跟 <code>int64</code> 变量之间仍需转换。</p>
<p><code>uintptr</code> 的范围则保证可以存下当前系统架构下的地址，无需特别考虑。</p>
<p>既然有不同的字节长度，就涉及到表示范围。范围太小，会导致数字溢出；范围太大，则引起内存的浪费。当然，如果只是个别变量，几个字节的差异可以忽略，可以直接用范围较大的类型；但涉及大数组或者大量生成的结构体的字段，则最好确定数据范围然后挑选合适的类型。（事实上，如果真的有需要节省空间和访问时间，还得考虑 内存对齐（memory alignment）或者 数据结构对齐（data structure alignment），那又是另一个话题了。）</p>
<ul>
<li>对于无符号整型，假设位宽为 N（下同），表示范围为 $ 0 \sim 2^N - 1 $ ，如 <code>uint8</code> 表示的最大值为 $ 2^8 - 1 = 255 $ 。这个值除了自己算，也可以通过 <code>math</code> 包的常量 <code>math.MaxUint8</code> 获得。16、32、64 位以此类推。</li>
<li>对于有符号整型，最高位表示符号位，正负数的范围分别只有无符号数的一半（实际上因为不需要表示 负零，负数范围多一个），表示范围为 $ -2^{N-1} \sim 2^{N-1} - 1 $ ，如 <code>int8</code> 最小值为 -128，最大值为 127。这两个值也可以通过 <code>math</code> 包的常量 <code>math.MinInt8</code> 和 <code>math.MaxInt8</code> 获得。其它有符号整型以此类推。</li>
<li>浮点数实际上是 科学记数法 的二进制实现，二进制位除了最高位的符号位，剩下的分成了 尾数 和 指数 两部分。跟整型不同的是，浮点数的范围包括 绝对值最大值 和 非零绝对值最小值（跟指数位宽有关），还有小数精度的问题（跟尾数位宽有关）。这些规范其实是 IEEE-754 国际标准规定的。因为精度还涉及进制转换问题，就不在这里展开。<code>float32</code> 的绝对值范围可以通过 <code>math.SmallestNonzeroFloat32</code> 和 <code>math.MaxFloat32</code> 获得。64 位以此类推。</li>
<li>复数实际上由实部和虚部两个浮点数（各占一半位宽）组成，具体范围参考浮点数。</li>
</ul>
<p>既然数字类型都有表示范围，而浮点数还可能有精度损失（有可能是超出尾数范围，也可能是进制转换造成），那么就有可能表示范围或者精度不足。如果需要表示超出范围的值，或者涉及金钱等业务需要非常高的精度，则需要用到 <code>math/big</code> 包的几个大数类型，包括整型 <code>big.Int</code> 、浮点型 <code>big.Float</code> 和 分数 <code>big.Rat</code> 。留个印象，后续再介绍。</p>
<h4 id="1-3-字符串类型"><a href="#1-3-字符串类型" class="headerlink" title="1.3 字符串类型"></a>1.3 字符串类型</h4><p>类型标识符 <code>string</code> ，就是一串有固定长度的字符序列。</p>
<ul>
<li>字符串的底层是一个 byte 数组（以 UTF-8 编码，所以支持中文），可以当做 byte 数组访问读取。例如读取 <code>str[i]</code> 得到的就是一个 byte 类型的值。 </li>
<li><strong>字符串是不可变类型，内容不可修改；对字符串变量的修改实质上是整个替换</strong>。试图修改字符串的内容（如 <code>str[0] = &#39;a&#39;</code>），会引起报错。而 <code>str1 = str1 + str2</code> 中则是合法，因为 <code>str1</code> 和 <code>str2</code> 的内存都没有被修改，而是开辟新的内存存放拼接后的字符串，然后 <code>str1</code> 指向新的内存。原来 <code>str1</code> 的内存如果没有被其它地方引用，会在后续的 GC 被回收。这点有点像 Java 的 String。大量频繁拼接字符串的场景，需要考虑优化。</li>
<li>如果需要修改，则要转换成切片 <code>[]byte</code> 或者 <code>[]rune</code> ；修改完之后也可以重新转换为 <code>string</code>。<strong>无论哪个方向的转换，内存都发生了拷贝（copy），返回的新切片 / 新字符串指向新分配的内存，所以互不影响。</strong> 频繁转换时需要考虑性能损耗。</li>
<li><code>[]byte</code> 和 <code>[]rune</code> 差别是前者每个字符的范围是只有一个字节的 Unicode （只存得下 ASCII 码 + 拉丁符号扩展1），后者则是 四个字节的 Unicode。包含中文等等内容、字符编码可能大于一个字节的字符串只能转换为 <code>[]rune</code> 否则会出现乱码；反之 ASCII 码的内容转换为 <code>[]rune</code> 并不影响内容正确性，只是有一定的性能浪费而已。</li>
<li><strong>跟很多语言不同，Go 字符串的零值是空串 <code>&quot;&quot;</code> 。</strong> 而不是特殊的空值 <code>nil</code>、<code>null</code>、<code>None</code> 等。未初始化的字符串和空白字符串不像 Java 那样需要区分，判断都是 <code>if str == &quot;&quot;</code> 。</li>
<li>字符串有两种字面量形式，除了以双引号包裹内容，还可以用反引号（&#96; ，<code>Esc</code> 下方的键）包裹。区别是双引号内支持转义，不支持换行；反引号字符串恰恰相反，不支持转义，所有字符都会原样保留，包括换行（但为了跨平台兼容性，换行符统一替换成 <code>newline</code>，去掉 <code>carriage return</code>）。反引号字符串常用于一大段的内容（为了保留换行）和 正则表达式（为了保留特殊符号不被转义）。</li>
<li>字符串支持的转义字符跟字符字面量一致，只有一个差别：不支持 <code>\&#39;</code> 改为支持 <code>\&quot;</code> ；这是因为字符串以双引号界定，单引号不再是特殊字符。</li>
</ul>
<p>string 本身值得专门开一篇文章，先说这么多。</p>
<h3 id="2-派生类型"><a href="#2-派生类型" class="headerlink" title="2. 派生类型"></a>2. 派生类型</h3><p>派生类型，又叫衍生类型。顾名思义，它是在其它类型的基础上衍生出来的。</p>
<p>一个派生类型，严格来说，是一个大类，底下可以包含多种具体类型。例如 <code>*int</code> 和 <code>*bool</code> 虽然同为指针类型，但由于指向的类型不同，它们也是不同的类型（称作 <code>int</code> 指针 和 <code>bool</code> 指针）；<code>int</code> 数组 和 <code>bool</code> 数组也是不同的类型；甚至，长度为 10 的 <code>int</code> 数组 <code>[10]int</code> 和 长度为 11 的数组 <code>[11]int</code> 也是不同的类型。</p>
<p>派生类型是个比较大的话题，个别类型光一个类型就够写一篇文章，所以这里不详细展开，只作简单罗列：</p>
<ul>
<li><p>指针：从 C / C++ 一脉相承，内存管理的高阶操作；不过 Go 的指针比 C / C++ 要简单和安全得多，类型安全，也不用关心内存的释放和悬挂指针。</p>
<p>  <code>var iptr *int</code> 声明了一个指向 <code>int</code> 的指针 <code>iptr</code> ，零值为 <code>nil</code> （相当于某些语言的 <code>null</code> ，<code>None</code> ）。</p>
</li>
<li><p>数组（array）和 切片（slice）：类似其它语言的数组和动态数组。（注意这是两个不同类型，只是性质相近一起介绍）</p>
<p>  <code>var a [10]int</code> 声明了一个长度为 10 的 <code>int</code> 数组 <code>a</code>，零值为成员都是零值的数组，可以直接使用。</p>
<p>  <code>var s []int</code> 则声明了一个 <code>int</code> 切片 <code>s</code>，零值为 <code>nil</code> 。</p>
</li>
<li><p>映射（map）：类似其它语言的 map。不过不像 C++ 和 Java 作为库引入，Go 的 map 是语言内置的。因为 Go 没有 集合（set），很多时候也需要用 map 模拟。</p>
<p>  <code>var m map[string]int</code> 声明了一个 key 为 <code>string</code> ，value 为 <code>int</code> 的 map <code>m</code> ，零值为 <code>nil</code> 。</p>
</li>
<li><p>函数（function）：Go 里面函数也是第一等公民。函数既然是一种类型，那么就可以作为变量和参数。Go 支持函数式编程。</p>
<p>  <code>var f func(int)bool</code> 声明了一个 『接受一个 <code>int</code> 参数并返回一个 <code>bool</code> 值的函数』变量 <code>f</code> ，零值为 <code>nil</code> 。</p>
<p>  当然你也可以用 <code>func</code> 关键字直接声明一个函数 <code>f</code> ：</p>
  <figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">f</span><span class="params">(a <span class="keyword">int</span>)</span> <span class="title">bool</span></span> &#123;</div><div class="line">    <span class="comment">// 函数体</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>  两者都是通过 <code>f()</code> 调用（当然，实际调用要提供一个 <code>int</code> 参数）。后者只能用于全局（包级）函数，必须给出函数体，<code>f</code> 不是一个变量，<code>f</code> 的值是一个具体的函数而且不能修改。从效果上接近一个函数常量（但不是）。</p>
</li>
<li><p>结构体（struct）：类似 C / C++ 的结构体，但是可以定义行为（方法）。Go 没有 类（class）和 继承（inheritance），而是通过 结构体 和 组合（composition）实现面向对象。</p>
<p>  下面声明了一个『拥有一个 <code>string</code> 字段 和一个 <code>int</code> 字段 的结构体』的变量 <code>alice</code> ，零值是所有字段都为对应零值的结构体：</p>
  <figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> alice <span class="keyword">struct</span> &#123;</div><div class="line">    name <span class="keyword">string</span></div><div class="line">    age  <span class="keyword">int</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>  但这样写，每次声明都要把结构体重新写一遍，啰嗦还容易错——只要字段的名称、类型或者顺序，随便一样有差别，都会被认为是不同的类型。一般情况下，除非这个结构体只使用这么一次，否则都不应该这样写。</p>
<p>  正确的做法，是给结构体一个类型名，然后用名字来声明：</p>
  <figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">type</span> person <span class="keyword">struct</span> &#123;</div><div class="line">    name <span class="keyword">string</span></div><div class="line">    age  <span class="keyword">int</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> (</div><div class="line">    alice person</div><div class="line">    bob   person</div><div class="line">)</div></pre></td></tr></table></figure>
<p>  在这里 <code>person</code> 成了一个新的自定义类型，与之相对应，前面没有定义名称的结构体称为匿名结构体。</p>
</li>
<li><p>接口（interface）：接口是一系列行为（方法签名，方法是一种特殊的函数）的集合。跟其它语言不同，Go 的接口不需要显式声明实现（implementation），一个类型只要实现了接口的所有方法，它就隐式地满足接口。是否满足接口可以在编译期静态检查，所以是类型安全的。<strong>Go 实现了类型安全的鸭子类型（duck typing）</strong> 。这种设计是 Go 的组合式面向对象的重要组成部分。</p>
<p>  跟结构体类似，接口的定义比较长，也应该定义成一个自定义类型：</p>
  <figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">type</span> runner <span class="keyword">interface</span> &#123;</div><div class="line">    <span class="comment">// 满足 runner 接口的类型，应该具有 walk() 和 run() 两个方法</span></div><div class="line">    walk() <span class="comment">// walk 是一个没有参数也没有返回值的方法</span></div><div class="line">    run(<span class="keyword">int</span>)<span class="keyword">bool</span> <span class="comment">// run 方法接收一个 int 参数，并返回一个 bool 值</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> (</div><div class="line">    cindy runner</div><div class="line">    danny runner</div><div class="line">)</div></pre></td></tr></table></figure>
<p>  这里声明了两个 『拥有两个方法的接口』的变量。接口变量的零值是 <code>nil</code> ，可以接受任何满足接口的类型的值。</p>
</li>
<li><p>通道（channel）：channel 用于并发时在协程间通信，是 CSP 模型的重要部分。</p>
<p>  channel 除了区分传递的消息的类型，还分读写和缓冲区大小。其中缓冲区在初始化时决定，剩下的在类型上体现：</p>
  <figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> (</div><div class="line">    ich <span class="keyword">chan</span> <span class="keyword">int</span> <span class="comment">// 可以读写的通道，消息类型是 int</span></div><div class="line">    bch &lt;-<span class="keyword">chan</span> <span class="keyword">bool</span> <span class="comment">// 只读的通道，消息类型是 bool</span></div><div class="line">    fch <span class="keyword">chan</span>&lt;- <span class="keyword">float64</span> <span class="comment">// 只写的通道，消息类型是 float64</span></div><div class="line">)</div></pre></td></tr></table></figure>
<p>  channel 的零值为 <code>nil</code> 。</p>
</li>
</ul>
<p>关于派生类型，最后补充两点：</p>
<ol>
<li><p>所有零值不是 <code>nil</code> 的变量，都可以声明之后直接使用（只不过值都是零）；而零值为 <code>nil</code> 的类型，意味着需要额外的初始化，其中 切片（slice）、映射（map）和 通道（channel）都是通过内置函数 <code>make()</code> 申请内存并初始化。</p>
</li>
<li><p>先定义为自定义类型，再用新类型声明变量，对 结构体 和 接口 来说，既不是必选项，也不是特权。这句话的意思是：</p>
<ul>
<li>不是必选项：匿名结构体 和 匿名接口 也是合法的代码。只不过由于这两种类型的定义太长（一定会换行），匿名使用会有很多麻烦，还是推荐先定义类型。这虽然不是强制选项，却是最佳实践。</li>
<li>不是特权：只要你愿意，所有类型都可以定义为自定义类型（参考下一节），只不过有没有必要而已。</li>
</ul>
</li>
</ol>
<p>这部分内容只是为了让大家对派生类型有一个整体的印象。细节会在用到这些类型时详细展开。</p>
<h3 id="3-自定义类型"><a href="#3-自定义类型" class="headerlink" title="3. 自定义类型"></a>3. 自定义类型</h3><p>Go 使用 <code>type</code> 关键字自定义类型，有两种用法：</p>
<h4 id="3-1-类型定义"><a href="#3-1-类型定义" class="headerlink" title="3.1 类型定义"></a>3.1 类型定义</h4><p>语法 <code>type TypeName TypeDefinition</code></p>
<p>例子：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">type</span> NewInt <span class="keyword">int64</span></div><div class="line"></div><div class="line"><span class="keyword">type</span> NewStruct <span class="keyword">struct</span> &#123;</div><div class="line">    val <span class="keyword">int</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">type</span> Bitmap []<span class="keyword">uint64</span></div><div class="line"></div><div class="line"><span class="keyword">type</span> Runner <span class="keyword">interface</span> &#123;</div><div class="line">    Run()</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">type</span> Handler <span class="function"><span class="keyword">func</span><span class="params">(req Request)</span><span class="title">Response</span></span></div></pre></td></tr></table></figure>
<p><strong>类型定义</strong> 看起来很像 C / C++ ，只是把名字移到了前面：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// C</span></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> &#123;</div><div class="line">    <span class="keyword">int</span> val;</div><div class="line">&#125; NewStruct;</div></pre></td></tr></table></figure>
<p>或者 Java 的</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Java</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">NewStruct</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> val;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>虽然像，差别也很明显：</p>
<ul>
<li>Java 里，新名字只能是一个类（即使里面只有一个值）；Go 既能创建新结构体 / 接口，也能复用已有的类型——包括基本类型和内置的派生类型。</li>
<li>C 的 <code>typedef</code> 倒是也可以用于基本类型，但得到的实际上是一个别名，新旧类型仍然是同一种类型；而 Go 声明了一种新的类型。</li>
</ul>
<p>以 <code>type NewInt int64</code> 举例，虽然它们共享同样的内存实现（8 个字节的连续内存），在基本运算符上有同样的结果，但是 <code>NewInt</code> 被认为是跟 <code>int</code> 不同的一个类型，可以拥有自己的方法。两种类型不能直接一起运算，也不能用作另一种类型的参数，需要经过转换。</p>
<p>不直接使用原类型，而是定义命名的新类型，我认为有以下几个原因：</p>
<ol>
<li><p>使用方便。</p>
<p> 这是对冗长的派生类型——尤其是 结构体 和 接口 而言的。简洁的名字当然比冗长的结构方便且不易出错。</p>
</li>
<li><p>自注释。</p>
<p> 名字可以体现用途和意图。</p>
</li>
<li><p>借用静态检查发现错误。</p>
<p> 将底层实现一样但是业务逻辑不一致的类型分别定义为不同的类型，可以借由静态检查发现逻辑错误。这在上一期类型转换部分，我用 砧板 和 地板 的 底层类型都是 木板 做了一个类比。</p>
</li>
<li><p>添加方法。</p>
<p> Go 可以（且只可以）给当前包定义的类型添加方法。内置类型和导入类型定义成新类型之后，就可以给新类型添加方法，实现面向对象编程。</p>
<p> 需要注意的是，定义成新类型之后，原来类型的方法就全部丢失，不能再访问了（毕竟已经不是同一个类型）。如果需要保留原来的方法，应该选择将旧类型匿名嵌入新类型的结构体。匿名嵌入效果上接近继承，实际上是组合，只是跟一般成员组合相比，被匿名嵌入类型的成员和方法可以直接访问。具体在 方法 和 结构体 部分展开。</p>
</li>
</ol>
<h4 id="3-2-类型别名"><a href="#3-2-类型别名" class="headerlink" title="3.2 类型别名"></a>3.2 类型别名</h4><p>语法 <code>type TypeAlias = AnotherType</code></p>
<p>例子：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">type</span> IntAlias = <span class="keyword">int</span></div><div class="line"><span class="keyword">type</span> StructAlias = NewStruct</div></pre></td></tr></table></figure>
<p><strong>类型别名</strong> <code>type IntAlias = int</code> 中，<code>IntAlias</code> 被认为是 <code>int</code> 的别名，看作是同一类型，可以直接一起运算或者作为参数，无需转换。类型别名自 Go 1.9 引入，用来解决迁移、升级等重构场景下，类型重命名的兼容性问题，以及方便引用外部导入的类型。</p>
<p><strong>实际上，类型别名仅在代码中存在，编译时会全部替换成实际的类型。只有类型定义产生了新的类型。</strong></p>
<h3 id="4-枚举（模拟）"><a href="#4-枚举（模拟）" class="headerlink" title="4. 枚举（模拟）"></a>4. 枚举（模拟）</h3><p>说到自定义类型，就顺便提一下枚举。</p>
<p>在数学和计算机科学上，枚举是指列出一个有限集合的所有成员。而枚举类型是一种特殊的类型，只能取限定的某几个值。有些语言只是限定了枚举类型的取值（C / C++）；而有些语言则（以常量的形式）直接预先初始化了枚举类型所有可能值的实例，变量不仅仅只能取有限的值，而是只能是这几个实例之一（Java，Python）。</p>
<p><strong>Go 没有提供对枚举的支持</strong>。是的，Go 跟谁都不像，根本没有枚举。相对应地，在 Go 里一般通过 自定义类型 + 常量 模拟枚举。我们来看看官方库里面 <code>time</code> 包对 月份 <code>Month</code> 和 周几 <code>Weekday</code> 的定义：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> time</div><div class="line"></div><div class="line"><span class="comment">// A Month specifies a month of the year (January = 1, ...).</span></div><div class="line"><span class="keyword">type</span> Month <span class="keyword">int</span></div><div class="line"></div><div class="line"><span class="keyword">const</span> (</div><div class="line">    <span class="comment">// 如果理解不了这部分，请翻看上一期常量部分关于自动补全和 iota 的内容</span></div><div class="line">    January Month = <span class="number">1</span> + <span class="literal">iota</span></div><div class="line">    February</div><div class="line">    March</div><div class="line">    April</div><div class="line">    May</div><div class="line">    June</div><div class="line">    July</div><div class="line">    August</div><div class="line">    September</div><div class="line">    October</div><div class="line">    November</div><div class="line">    December</div><div class="line">)</div><div class="line"></div><div class="line"><span class="comment">// String returns the English name of the month ("January", "February", ...).</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(m Month)</span> <span class="title">String</span><span class="params">()</span> <span class="title">string</span></span> &#123;</div><div class="line">    <span class="keyword">if</span> January &lt;= m &amp;&amp; m &lt;= December &#123;</div><div class="line">        <span class="comment">// longMonthNames 是一个预先定义的字符串切片，里面按顺序保存了每个月份的字符串</span></div><div class="line">        <span class="keyword">return</span> longMonthNames[m<span class="number">-1</span>]</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// 如果 m 的值不在范围内，返回表示错误的字符串</span></div><div class="line">    buf := <span class="built_in">make</span>([]<span class="keyword">byte</span>, <span class="number">20</span>)</div><div class="line">    n := fmtInt(buf, <span class="keyword">uint64</span>(m))</div><div class="line">    <span class="keyword">return</span> <span class="string">"%!Month("</span> + <span class="keyword">string</span>(buf[n:]) + <span class="string">")"</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// A Weekday specifies a day of the week (Sunday = 0, ...).</span></div><div class="line"><span class="keyword">type</span> Weekday <span class="keyword">int</span></div><div class="line"></div><div class="line"><span class="keyword">const</span> (</div><div class="line">    Sunday Weekday = <span class="literal">iota</span></div><div class="line">    Monday</div><div class="line">    Tuesday</div><div class="line">    Wednesday</div><div class="line">    Thursday</div><div class="line">    Friday</div><div class="line">    Saturday</div><div class="line">)</div><div class="line"></div><div class="line"><span class="comment">// String returns the English name of the day ("Sunday", "Monday", ...).</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(d Weekday)</span> <span class="title">String</span><span class="params">()</span> <span class="title">string</span></span> &#123;</div><div class="line">    <span class="keyword">if</span> Sunday &lt;= d &amp;&amp; d &lt;= Saturday &#123;</div><div class="line">        <span class="comment">// 跟月份类似，longDayNames 也是预先定义好的字符串切片</span></div><div class="line">        <span class="keyword">return</span> longDayNames[d]</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// 同样地，超出范围就返回表示错误的字符串</span></div><div class="line">    buf := <span class="built_in">make</span>([]<span class="keyword">byte</span>, <span class="number">20</span>)</div><div class="line">    n := fmtInt(buf, <span class="keyword">uint64</span>(d))</div><div class="line">    <span class="keyword">return</span> <span class="string">"%!Weekday("</span> + <span class="keyword">string</span>(buf[n:]) + <span class="string">")"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在这个例子里，<code>Month</code> 和 <code>Weekday</code> 都是底层类型为 <code>int</code> 的自定义类型；然后这两个类型定义了一系列的常量作为取值范围，并且定义了一个 <code>String()</code> 方法，返回对应值的字符串形式。</p>
<p>在 1.4 之后，Go 工具链提供了 <code>go generate</code> 命令，配合 <code>stringer</code> 工具可以自动生成常量的 <code>String()</code> 方法。除此之外，也可以按需给新类型添加各种方法，模拟其他语言里的枚举，或者增加需要的功能。详情可以自己查阅，这里不再展开。</p>
<p>有独立的类型、通过常量给定取值、能返回字符串，肯定比直接用一个整型数来表示要强。自定义类型被认为是跟原来不一样的类型，在赋值或者传参过程中，如果使用了不同类型的变量，直接在编译时就报错了；另一方面，如果只通过常量引用这些 “枚举类型” 的值，取值范围也限制住了。基本实现了枚举的目的。</p>
<p>但也只能说部分实现。提供的常量只是给出了范围的建议值，而不是强制值。Go 没有提供『把类型的取值范围硬性限制在某几个值』的语义。新类型的取值范围仍然是和底层类型一样：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> <span class="string">"time"</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">    <span class="comment">// 这是合法的，-1 作为字面量是 untyped 的，可以自动转换类型</span></div><div class="line">    <span class="keyword">var</span> m1 time.Month = <span class="number">-1</span></div><div class="line">    </div><div class="line">    <span class="comment">// 又或者是忘了赋值，那么 m2 的值就为 零值，即 0，也不在常量范围内</span></div><div class="line">    <span class="keyword">var</span> m2 time.Month</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>如果说 <code>m1</code> 是违反了（模拟的）枚举类型只使用常量引用的原则，注意一下就可以避免；那么 <code>m2</code> 这种忘记赋值的情况可能更难发现一些。</p>
<p>既然没有办法通过类型安全本身限制取值，就只能在使用时注意判断值的范围，特别要处理意外的情况。在判断枚举值时，一般使用 <code>if-else</code> 或者 <code>switch-case</code>  代码块，这时记得加上一个 <code>else</code> 或者 <code>default</code> 处理无效值。又或者干脆给类型添加一个 <code>IsValid()bool</code> 方法，判断值是否有效。</p>
<p>当然这种实现方式也并不全是坏处。Go 没有限定枚举必须是什么样子，就可以按自己的需要设计：</p>
<ul>
<li>枚举的底层值不一定是整数，可以是任意基本类型。</li>
<li>枚举的值允许重复；这个有些时候可能会引起错误，有些时候又可能有用。</li>
<li>没有增加特殊情况，保持了类型系统的简单和高效；引入专门的枚举类型其实涉及很多问题，例如序列化和反序列化怎么处理。</li>
</ul>
<p>总的来说，我个人觉得在枚举这个问题上处理得不够好，好像不太符合 Go 一向强类型和自带最佳实践的风格。当然也有可能是我理解得不够深入。但无论怎么说，目前的实现方式在官方库非常普遍，出于兼容性的考虑，至少在 Go 1.x 阶段不太会改动的样子。那就接受这个设定，并且小心避开潜在的坑吧。</p>
<h2 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h2><p>问题1 ：</p>
<p>假设程序中需要储存一个状态，有 待办、进行中、完成 三种状态，应该怎么样定义类型？</p>
<p>如果这样的状态需要储存非常多个，定义成一个大数组储存，该如何节省空间？</p>
<p>问题 2：</p>
<p>问以下程序的输出，为什么。老规矩，不用运行就得出答案更佳。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">    <span class="keyword">var</span> str1 = <span class="string">"hello world"</span></div><div class="line">    <span class="keyword">var</span> tmp1 = <span class="string">"hello"</span></div><div class="line">    <span class="keyword">var</span> tmp2 = <span class="string">"world"</span></div><div class="line">    <span class="keyword">var</span> str2 = tmp1 + <span class="string">" "</span> + tmp2</div><div class="line">    fmt.Println(str1 == str2)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><br></p>
<hr>
<h2 id="上期练习答案"><a href="#上期练习答案" class="headerlink" title="上期练习答案"></a>上期练习答案</h2><p>第二期最后的练习，答案如下</p>
<p>如果还没做练习，不要直接看答案</p>
<p><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 全局常量和变量是经过依赖分析后统一初始化的</span></div><div class="line"><span class="comment">// 只要没有依赖环，声明先后不影响引用</span></div><div class="line"><span class="comment">// 但局部常量和变量不能这样做</span></div><div class="line"><span class="keyword">const</span> (</div><div class="line">    A <span class="keyword">uint8</span> = B <span class="comment">// uint8, 255</span></div><div class="line">    B       = <span class="number">255</span> <span class="comment">// 整型字面量默认类型为 untyped int，255</span></div><div class="line">)</div><div class="line"></div><div class="line"><span class="keyword">var</span> (</div><div class="line">    a <span class="keyword">uint64</span> = A / <span class="number">2</span> <span class="comment">// 类型报错！A 的 uint8 是显式类型，2 自动转换为 uint8 参与运算，所以 A / 2 表达式整体也是 uint8，不能自动转换为 uint64</span></div><div class="line">    b <span class="keyword">int8</span>   = B / <span class="number">2</span> <span class="comment">// B 是 untyped 无类型，表达式整体也是 untyped int，结果自动转换为 int8，结果为 127（整数除法），刚好不超过 int8 的范围</span></div><div class="line">)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">    <span class="comment">// 以下的 A, B, a, b 均没有重复声明，这是因为作用域不同，发生了 shadow</span></div><div class="line">    </div><div class="line">    A := <span class="keyword">byte</span>(<span class="string">'0'</span>) <span class="comment">// '0' 为 untyped rune，显式转换为 byte，值范围没有超出，所以类型为 byte；byte 实际是 uint8 的别名，'0' 的值为 48，只有作为字符格式化时才输出字符 '0'</span></div><div class="line">    B := <span class="keyword">byte</span>(<span class="string">'1'</span>) <span class="comment">// 类型同上，值为 49</span></div><div class="line">    C := A - B <span class="comment">// A, B 均为 byte 类型，所以表达式的结果也是 byte，C 也是 byte；计算结果为 -1，但 byte（即 uint8，无符号 8 位整型）最小值是 0，下溢出，截取得到 255 （惊不惊喜，意不意外）；这种截取很容易导致意料以外的结果，需要尽量避免</span></div><div class="line">    fmt.Println(C) <span class="comment">// 输出 255</span></div><div class="line"></div><div class="line">    <span class="keyword">const</span> a = <span class="string">'0'</span> <span class="comment">// 没有指定类型，类型为 untyped rune，值为 48</span></div><div class="line">    <span class="keyword">const</span> b = <span class="string">'1'</span> <span class="comment">// 类型为 untyped rune，值为 49</span></div><div class="line">    fmt.Println(<span class="keyword">byte</span>(a - b)) <span class="comment">// 类型转换错误！a - b 的结果类型为 untyped rune，值为 -1，转换成 byte 会下溢出；常量在转换中不允许溢出</span></div><div class="line"></div><div class="line">    i := <span class="number">0x1e</span>+<span class="number">2</span> <span class="comment">// 这其实是一个表达式，格式化后会自动在加号两边添加空格；加号前面的数是十六进制的 30，整体就是 30 + 2；两个数都是整型字面量，所以表达式和变量的类型都是 untyped int，值为 32</span></div><div class="line">    j := <span class="number">1e+2</span> <span class="comment">// 浮点数字面量，表示 1 x 10^2，即 100，类型为 untyped float；注意 j 没有任何有效使用，会报 not used 错误！</span></div><div class="line">    <span class="keyword">for</span> i = <span class="number">0</span>; i &lt; <span class="number">1</span>; i++ &#123; <span class="comment">// i 在这里是赋值，在循环条件 i &lt; 1 中算有效使用（涉及到了循环，略有超纲，但有其它语言经验的话问题不大）</span></div><div class="line">        <span class="keyword">for</span> j := <span class="number">0</span>; j &lt; <span class="number">1</span>; j++ &#123; <span class="comment">// 短声明产生了一个新的 j ，跟前面的 j 无关</span></div><div class="line">            <span class="comment">// 空循环体</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// 现在 i, j 分别是多少</span></div><div class="line">    <span class="comment">// i 在循环中先是被赋值为 0，然后自增，到 1 时不满足循环条件退出，所以 i 为 1</span></div><div class="line">    <span class="comment">// （外层）j 没有被使用，还是 1e+2 （100）</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>你答对了吗？</p>
<hr>
<p><img src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" alt="知识共享 “署名-非商业性使用-相同方式共享” 4.0 (CC BY-NC-SA 4.0)”许可协议"><br>本文为本人原创，采用<a href="http://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="external">知识共享 “署名-非商业性使用-相同方式共享” 4.0 (CC BY-NC-SA 4.0)”许可协议</a>进行许可。<br>本作品可自由复制、传播及基于本作品进行演绎创作。如有以上需要，请留言告知，在文章开头明显位置加上署名（Jayce Chant）、原链接及许可协议信息，并明确指出修改（如有），不得用于商业用途。谢谢合作。<br>请点击查看<a href="http://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="external">协议</a>的中文摘要。</p>

      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://jaycechant.info/2020/golang-in-action-day-3/" data-id="ckor7yfo7005t5cxltn74co7f" class="article-share-link" data-share="baidu">分享到</a>
      

      
        <a href="https://jaycechant.info/2020/golang-in-action-day-3/#disqus_thread" class="article-comment-link">评论</a>
      

      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/golang/">golang</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2020/translation-billion-dollar-mistake-in-go/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">下一篇</strong>
      <div class="article-nav-title">
        
          Go 语言中价值十亿美元的错误（翻译）
        
      </div>
    </a>
  
  
    <a href="/2020/golang-in-action-day-2/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">上一篇</strong>
      <div class="article-nav-title">Go 语言实战（2）： 常量与变量</div>
    </a>
  
</nav>

  
</article>


  <section id="comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>
  </section>
</section>
      
      <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Go-语言实战/">Go 语言实战</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/刷题/">刷题</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/科普/">科普</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/粤语/">粤语</a><span class="category-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/Algorithm/" style="font-size: 13.33px;">Algorithm</a> <a href="/tags/Anaconda/" style="font-size: 10px;">Anaconda</a> <a href="/tags/Android/" style="font-size: 11.67px;">Android</a> <a href="/tags/Android-sdk/" style="font-size: 10px;">Android-sdk</a> <a href="/tags/CentOS/" style="font-size: 10px;">CentOS</a> <a href="/tags/DNS/" style="font-size: 10px;">DNS</a> <a href="/tags/JCE/" style="font-size: 10px;">JCE</a> <a href="/tags/Java/" style="font-size: 11.67px;">Java</a> <a href="/tags/JavaMail/" style="font-size: 10px;">JavaMail</a> <a href="/tags/Jenkins/" style="font-size: 16.67px;">Jenkins</a> <a href="/tags/LeetCode/" style="font-size: 15px;">LeetCode</a> <a href="/tags/Linux/" style="font-size: 10px;">Linux</a> <a href="/tags/Markdown/" style="font-size: 13.33px;">Markdown</a> <a href="/tags/Mathjax/" style="font-size: 10px;">Mathjax</a> <a href="/tags/OJ/" style="font-size: 10px;">OJ</a> <a href="/tags/Octopress/" style="font-size: 10px;">Octopress</a> <a href="/tags/OpenGrok/" style="font-size: 10px;">OpenGrok</a> <a href="/tags/Python/" style="font-size: 16.67px;">Python</a> <a href="/tags/Ruby/" style="font-size: 10px;">Ruby</a> <a href="/tags/Syncthing/" style="font-size: 10px;">Syncthing</a> <a href="/tags/TDD/" style="font-size: 10px;">TDD</a> <a href="/tags/Tomcat/" style="font-size: 10px;">Tomcat</a> <a href="/tags/Ubuntu/" style="font-size: 11.67px;">Ubuntu</a> <a href="/tags/algorithm/" style="font-size: 11.67px;">algorithm</a> <a href="/tags/aliyun/" style="font-size: 10px;">aliyun</a> <a href="/tags/app/" style="font-size: 10px;">app</a> <a href="/tags/blog/" style="font-size: 13.33px;">blog</a> <a href="/tags/byobu/" style="font-size: 11.67px;">byobu</a> <a href="/tags/ctags/" style="font-size: 10px;">ctags</a> <a href="/tags/dep/" style="font-size: 11.67px;">dep</a> <a href="/tags/document/" style="font-size: 10px;">document</a> <a href="/tags/dropbox/" style="font-size: 10px;">dropbox</a> <a href="/tags/file-system/" style="font-size: 10px;">file-system</a> <a href="/tags/flutter/" style="font-size: 10px;">flutter</a> <a href="/tags/git/" style="font-size: 11.67px;">git</a> <a href="/tags/glide/" style="font-size: 10px;">glide</a> <a href="/tags/golang/" style="font-size: 20px;">golang</a> <a href="/tags/hexo/" style="font-size: 10px;">hexo</a> <a href="/tags/how-to/" style="font-size: 16.67px;">how-to</a> <a href="/tags/jpg/" style="font-size: 10px;">jpg</a> <a href="/tags/json/" style="font-size: 11.67px;">json</a> <a href="/tags/maven/" style="font-size: 10px;">maven</a> <a href="/tags/mirror/" style="font-size: 10px;">mirror</a> <a href="/tags/netdisk/" style="font-size: 10px;">netdisk</a> <a href="/tags/node-js/" style="font-size: 11.67px;">node.js</a> <a href="/tags/nodePPT/" style="font-size: 11.67px;">nodePPT</a> <a href="/tags/npm/" style="font-size: 10px;">npm</a> <a href="/tags/pgyer/" style="font-size: 10px;">pgyer</a> <a href="/tags/pip/" style="font-size: 15px;">pip</a> <a href="/tags/png/" style="font-size: 10px;">png</a> <a href="/tags/practice/" style="font-size: 11.67px;">practice</a> <a href="/tags/presentation/" style="font-size: 11.67px;">presentation</a> <a href="/tags/review/" style="font-size: 10px;">review</a> <a href="/tags/screen/" style="font-size: 11.67px;">screen</a> <a href="/tags/service/" style="font-size: 10px;">service</a> <a href="/tags/skill/" style="font-size: 13.33px;">skill</a> <a href="/tags/smtp/" style="font-size: 10px;">smtp</a> <a href="/tags/software/" style="font-size: 10px;">software</a> <a href="/tags/solution-report/" style="font-size: 10px;">solution-report</a> <a href="/tags/supervisor/" style="font-size: 10px;">supervisor</a> <a href="/tags/thought/" style="font-size: 10px;">thought</a> <a href="/tags/trouble/" style="font-size: 18.33px;">trouble</a> <a href="/tags/unfinished/" style="font-size: 13.33px;">unfinished</a> <a href="/tags/virtualenv/" style="font-size: 10px;">virtualenv</a> <a href="/tags/vsftp/" style="font-size: 10px;">vsftp</a> <a href="/tags/why/" style="font-size: 11.67px;">why</a> <a href="/tags/写作/" style="font-size: 13.33px;">写作</a> <a href="/tags/动态规划/" style="font-size: 10px;">动态规划</a> <a href="/tags/安全/" style="font-size: 10px;">安全</a> <a href="/tags/数据结构/" style="font-size: 10px;">数据结构</a> <a href="/tags/翻译/" style="font-size: 13.33px;">翻译</a> <a href="/tags/语言表达/" style="font-size: 10px;">语言表达</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">五月 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">三月 2021</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">一月 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">十二月 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">十一月 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">十月 2020</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">九月 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">八月 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">七月 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">六月 2020</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">五月 2020</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">四月 2020</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">三月 2020</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">二月 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">一月 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">十月 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">五月 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">四月 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">一月 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">十一月 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">十月 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">十月 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">九月 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">三月 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">二月 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">一月 2017</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">十二月 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">十一月 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">十月 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">八月 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">七月 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">六月 2016</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/04/">四月 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/04/">四月 2012</a><span class="archive-list-count">5</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">近期文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/golang-in-action-day-9-pointer-reference-and-value/">Go 语言实战（9）：指针、引用和值</a>
          </li>
        
          <li>
            <a href="/2021/pineapple-with-caramel-flavor/">18 公斤菠萝怎么吃？来个焦糖风味吧</a>
          </li>
        
          <li>
            <a href="/2021/golang-format-verbs/">Go 语言格式化动词</a>
          </li>
        
          <li>
            <a href="/2021/time-is-up/">现在写，可能都来不及了...</a>
          </li>
        
          <li>
            <a href="/2020/golang-in-action-day-8/">Go 语言实战（8）：命令行（3）CLI 框架</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">友情链接</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="https://hexo.io/zh-cn/" target="_blank">Hexo主页</a>
          </li>
        
          <li>
            <a href="https://hexo.io/zh-cn/docs/" target="_blank">Hexo文档</a>
          </li>
        
          <li>
            <a href="https://github.com/xiangming/landscape-plus" target="_blank">landscape-plus项目主页</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
      
    </div>
    <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2021 Jayce Sigit Chant<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
      .
      Theme by <a href="https://github.com/xiangming/landscape-plus" target="_blank">Landscape-plus</a>
    </div>
  </div>
</footer>
  </div>
  <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/list" class="mobile-nav-link">List</a>
  
    <a href="https://github.com/JayceChant" class="mobile-nav-link">Github</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
    <a href="/sitemap.xml" class="mobile-nav-link">Sitemap</a>
  
</nav>
  <!-- totop start -->
<div id="totop">
<a title="返回顶部"><img src="/img/scrollup.png"/></a>
</div>

<!-- totop end -->

<script>
  var disqus_shortname = 'jaycetb';
  
  var disqus_url = 'https://jaycechant.info/2020/golang-in-action-day-3/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<!-- 百度分享 start -->

<div id="article-share-box" class="article-share-box">
  <div id="bdshare" class="bdsharebuttonbox article-share-links">
    <a class="article-share-weibo" data-cmd="tsina" title="分享到新浪微博"></a>
    <a class="article-share-weixin" data-cmd="weixin" title="分享到微信"></a>
    <a class="article-share-qq" data-cmd="sqq" title="分享到QQ"></a>
    <a class="article-share-renren" data-cmd="renren" title="分享到人人网"></a>
    <a class="article-share-more" data-cmd="more" title="更多"></a>
  </div>
</div>
<script>window._bd_share_config={"common":{},"share":{"bdCustomStyle":"/css/bdshare.css"}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='//bdimg.share.baidu.com/static/api/js/share.js?cdnversion='+~(-new Date()/36e5)];</script>

<!-- 百度分享 end -->

<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>



<! -- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
                processEscapes: true
                    
}
  
        });
</script>

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
tex2jax: {
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
                  
}
    
        });
</script>

<script type="text/x-mathjax-config">
MathJax.Hub.Queue(function() {
            var all = MathJax.Hub.getAllJax(), i;
            for(i=0; i < all.length; i += 1) {
                            all[i].SourceElement().parentNode.className += ' has-jax';
                                    
            }
                
        });
</script>

<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


<script src="/js/script.js"></script>

</div>
</body>
</html>
